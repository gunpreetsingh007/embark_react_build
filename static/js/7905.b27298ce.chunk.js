"use strict";(self.webpackChunkembark_react=self.webpackChunkembark_react||[]).push([[7905],{37905:function(e,t,a){a.r(t);var l=a(27117),r=a(47701),i=a(48672),n=a(87315),u=a(78820),s=a(84373),o=a(24373),d=a(72791),c=a(72881),m=a(57689),p=a(7273),g=a(67604),b=a(80184);const v=new l.Z;t.default=e=>{var t,a,l,h,j,x,f;const[N,y]=(0,d.useState)(!1);let[P,E]=(0,d.useState)({image:{}});const I=(0,m.s0)(),{id:F}=(0,m.UO)(),[S,A]=(0,d.useState)([]),C=(0,d.useRef)();let[U,k]=(0,d.useState)([{productName:"",attributeValue:"",count:"",pictureUrl:"",productMainImageProgress:0,refNumber:"",hsnNumber:""}]);const w=e=>{let t=e.split("/");const a={method:"DELETE",body:{name:t[t.length-1]}};return v.callApi("/file/deleteFile",a)},O=(0,d.useCallback)((async()=>{y(!0);let e=await v.callApi("/popup/getPopupById/".concat(F||""),{method:"GET"});if(200==(null===e||void 0===e?void 0:e.status)){var t,a;e.data.data.image.progress=100,P=e.data.data,E(e.data.data);let l=null===e||void 0===e||null===(t=e.data)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.products.map((e=>(e.productMainImageProgress=100,e.attributeValue=Object.values(e.attributeCombination)[0],e)));k(l),y(!1)}}),[]);(0,d.useEffect)((()=>{"edit"==e.type&&O(),Z()}),[]);const Z=(0,d.useCallback)((async()=>{let e=await v.callApi("/addProduct/chooseProductAttributes",{method:"GET"});var t;200==(null===e||void 0===e?void 0:e.status)&&A(null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.data.map((e=>({value:e.id,label:e.attributeName}))))}),[]),M=async(e,t)=>{let a=new FormData;a.append("productImage",e);const l={method:"POST",headers:{"Content-Type":"multipart/form-data"},body:a,onUploadProgress:e=>{U[t].productMainImageProgress=Math.round(100*e.loaded/e.total),k([...U])}};let r=await v.callApi("/file/uploadFile",l);var i;200==r.status?(U[t].pictureUrl=null===r||void 0===r||null===(i=r.data)||void 0===i?void 0:i.data,k([...U])):(U[t].productMainImageProgress=-1,k([...U]))},T=async e=>{y(!0);let t=U[e].pictureUrl.split("/");const a={method:"DELETE",body:{name:t[t.length-1]}};let l=await v.callApi("/file/deleteFile",a);return 200===(null===l||void 0===l?void 0:l.status)?(y(!1),U[e].pictureUrl="",U[e].productMainImageProgress=0,k([...U]),"success"):(y(!1),"failed")};return(0,b.jsxs)(b.Fragment,{children:[N?(0,b.jsx)(c.Z,{}):null,(0,b.jsx)("div",{className:"container-fluid addEditProductContainer my-lg-5",children:(0,b.jsxs)(r.Z,{onSubmit:async t=>{y(!0);const{minimumAmount:a}=t,l={minimumAmount:a,image:{url:P.image.url}};let r=[];for(let e=0;e<U.length;e++){let a={};a.refNumber=t["refNumber".concat(e)],a.hsnNumber=t["hsnNumber".concat(e)],a.productName=t["productName".concat(e)],a.count=t["count".concat(e)],a.pictureUrl=U[e].pictureUrl,a.attributeCombination={},a.attributeCombination[t["attribute".concat(e)]]=t["attributeValue".concat(e)],r.push(a)}l.products=r,"edit"==e.type&&(l.id=P.id);let i={method:"edit"==e.type?"PUT":"POST",body:l},n="edit"==e.type?"/popup/updatePopup":"/popup/createPopup",u=await v.callApi(n,i);if(200===(null===u||void 0===u?void 0:u.status)){let t="edit"==e.type?"Updated successfully":"Popup successfully created";(0,g.Z)("Success",t,"success"),y(!1)}else(0,g.Z)("Error","Something went wrong","error"),y(!1);I("/manage-popups")},ref:C,children:[(0,b.jsxs)(n.X2,{children:[(0,b.jsx)(n.sg,{md:12,children:(0,b.jsx)(o.Z,{name:"minimumAmount",label:"Minimum Amount",required:!0,isFormInputElement:!0,value:null===(t=P)||void 0===t?void 0:t.minimumAmount})}),(0,b.jsx)(n.sg,{md:12,children:(0,b.jsx)(i.Z,{name:"image",label:"Popup Image",isFormInputElement:!0,required:!0,acceptedFormat:"image/png, image/jpeg, image/jpg",onChange:e=>(async e=>{let t=new FormData;t.append("productImage",e);const a={method:"POST",headers:{"Content-Type":"multipart/form-data"},body:t,onUploadProgress:e=>{P.image.progress=Math.round(100*e.loaded/e.total),E(JSON.parse(JSON.stringify(P)))}};let l=await v.callApi("/file/uploadFile",a);var r;200==l.status?(P.image.url=null===l||void 0===l||null===(r=l.data)||void 0===r?void 0:r.data,E(JSON.parse(JSON.stringify(P)))):(P.image.progress=-1,E(JSON.parse(JSON.stringify(P))))})(e),value:null!==(a=P)&&void 0!==a&&null!==(l=a.image)&&void 0!==l&&l.url?"https://embark.gunpreet.in/api/"+(null===(h=P)||void 0===h||null===(j=h.image)||void 0===j?void 0:j.url):"",deleteFile:async()=>{var e,t;y(!0);let a=(null===(e=P)||void 0===e||null===(t=e.image)||void 0===t?void 0:t.url).split("/");const l={method:"DELETE",body:{name:a[a.length-1]}};let r=await v.callApi("/file/deleteFile",l);return 200===(null===r||void 0===r?void 0:r.status)?(y(!1),P.image.url="",P.image.progress=0,E(JSON.parse(JSON.stringify(P))),"success"):(y(!1),"failed")},progress:null===(x=P)||void 0===x||null===(f=x.image)||void 0===f?void 0:f.progress})}),(0,b.jsxs)(n.sg,{md:12,children:[(0,b.jsx)(n.Dx,{children:"Add Products"}),U.map(((e,t)=>(0,b.jsxs)("div",{children:[(0,b.jsx)(n.sg,{md:12,children:(0,b.jsxs)("div",{className:"form-title",children:[(0,b.jsxs)("p",{children:["Product ",t+1," Details"]}),t?(0,b.jsxs)("p",{onClick:()=>(async e=>{let t=U[e],a=[];t.pictureUrl&&a.push(w(t.pictureUrl)),await Promise.all(a),U.splice(e,1),k([...U])})(t),children:[(0,b.jsx)(u.SV5,{}),"Delete Product ",t+1]}):null]})}),(0,b.jsx)(n.sg,{md:6,children:(0,b.jsx)(o.Z,{name:"productName".concat(t),label:"Product Name",value:e.productName,required:!0,isFormInputElement:!0})}),(0,b.jsx)(n.sg,{md:6,children:(0,b.jsx)(p.Z,{name:"attribute".concat(t),label:"Choose Attribute",required:!0,isFormInputElement:!0,value:Object.keys((null===e||void 0===e?void 0:e.attributeCombination)||{})[0],data:S})}),(0,b.jsx)(n.sg,{md:6,children:(0,b.jsx)(o.Z,{name:"attributeValue".concat(t),label:"Attribute Value",value:e.attributeValue,required:!0,isFormInputElement:!0})}),(0,b.jsx)(n.sg,{md:6,children:(0,b.jsx)(o.Z,{name:"count".concat(t),label:"Product Count",value:e.count,required:!0,isFormInputElement:!0})}),(0,b.jsx)(n.sg,{md:6,children:(0,b.jsx)(o.Z,{name:"refNumber".concat(t),label:"Reference Number",value:e.refNumber,required:!0,isFormInputElement:!0})}),(0,b.jsx)(n.sg,{md:6,children:(0,b.jsx)(o.Z,{name:"hsnNumber".concat(t),label:"Hsn Number",value:e.hsnNumber,required:!0,isFormInputElement:!0})}),(0,b.jsx)(n.sg,{md:12,children:(0,b.jsx)(i.Z,{name:"productImage".concat(t),label:"Product Main Image(single pic)",isFormInputElement:!0,required:!0,productVariantIndex:t,acceptedFormat:"image/png, image/jpeg, image/jpg",onChange:M,value:e.pictureUrl?"https://embark.gunpreet.in/api/"+e.pictureUrl:"",deleteFile:T,progress:e.productMainImageProgress})})]},t)))]})]}),(0,b.jsxs)("p",{className:"link-text",onClick:()=>{k([...U,{productName:"",attributeValue:"",count:"",pictureUrl:"",productMainImageProgress:0,refNumber:"",hsnNumber:""}])},children:[(0,b.jsx)(s.f8n,{})," Add Another Product"]}),(0,b.jsx)(n.Bo,{children:(0,b.jsxs)("div",{children:[(0,b.jsx)(n.ux,{style:{marginRight:12},children:"Cancel"}),(0,b.jsx)(n.un,{disabled:!1,onClick:()=>{var e;return null===(e=C.current)||void 0===e?void 0:e.handleSubmit()},children:"Submit"})]})})]})})]})}}}]);
//# sourceMappingURL=7905.b27298ce.chunk.js.map